"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.quickInit=quickInit,exports.pageLeave=pageLeave,exports.selfEvent=selfEvent,exports.pageEnter=pageEnter,exports.setTDChannelId=setTDChannelId,exports.setTDAccount=setTDAccount;var _system=_interopRequireDefault(require("@system.storage")),_system2=_interopRequireDefault(require("@system.router")),_system3=_interopRequireDefault(require("@system.app")),_system4=_interopRequireDefault(require("@system.fetch")),_system5=_interopRequireDefault(require("@system.device")),_system6=_interopRequireDefault(require("@system.geolocation")),_system7=_interopRequireDefault(require("@system.brightness")),_system8=_interopRequireDefault(require("@system.battery")),_system9=_interopRequireDefault(require("@system.network")),_TD_quick_config=_interopRequireDefault(require("./TD_quick_config"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var md5=function(){var ERROR="input is invalid type",WINDOW="object"===("undefined"==typeof window?"undefined":_typeof(window)),root=WINDOW?window:{};root.JS_MD5_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&"object"===("undefined"==typeof self?"undefined":_typeof(self)),NODE_JS=!root.JS_MD5_NO_NODE_JS&&"object"===("undefined"==typeof process?"undefined":_typeof(process))&&process.versions&&process.versions.node;NODE_JS?root=global:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_MD5_NO_COMMON_JS&&"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports,AMD="function"==typeof define&&define.amd,ARRAY_BUFFER=!root.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[128,32768,8388608,-2147483648],SHIFT=[0,8,16,24],OUTPUT_TYPES=["hex","array","digest","buffer","arrayBuffer","base64"],BASE64_ENCODE_CHAR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),blocks=[],buffer8,buffer,buffer8,blocks;ARRAY_BUFFER&&(buffer=new ArrayBuffer(68),buffer8=new Uint8Array(buffer),blocks=new Uint32Array(buffer)),!root.JS_MD5_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),!ARRAY_BUFFER||!root.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return"object"===_typeof(e)&&e.buffer&&e.buffer.constructor===ArrayBuffer});var createOutputMethod=function(t){return function(e){return new Md5(!0).update(e)[t]()}},createMethod=function(){var t=createOutputMethod("hex");NODE_JS&&(t=nodeWrap(t)),t.create=function(){return new Md5},t.update=function(e){return t.create().update(e)};for(var e=0;e<OUTPUT_TYPES.length;++e){var a=OUTPUT_TYPES[e];t[a]=createOutputMethod(a)}return t},nodeWrap=function nodeWrap(method){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),nodeMethod=function(e){if("string"==typeof e)return crypto.createHash("md5").update(e,"utf8").digest("hex");if(null==e)throw ERROR;return e.constructor===ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||ArrayBuffer.isView(e)||e.constructor===Buffer?crypto.createHash("md5").update(new Buffer(e)).digest("hex"):method(e)};return nodeMethod};function Md5(e){var t;e?(blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks,this.buffer8=buffer8):ARRAY_BUFFER?(t=new ArrayBuffer(68),this.buffer8=new Uint8Array(t),this.blocks=new Uint32Array(t)):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}return Md5.prototype.update=function(e){if(!this.finalized){var t,a=_typeof(e);if("string"!==a){if("object"!==a)throw ERROR;if(null===e)throw ERROR;if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||ARRAY_BUFFER&&ArrayBuffer.isView(e)))throw ERROR;t=!0}for(var s,n,i=0,r=e.length,c=this.blocks,o=this.buffer8;i<r;){if(this.hashed&&(this.hashed=!1,c[0]=c[16],c[16]=c[1]=c[2]=c[3]=c[4]=c[5]=c[6]=c[7]=c[8]=c[9]=c[10]=c[11]=c[12]=c[13]=c[14]=c[15]=0),t)if(ARRAY_BUFFER)for(n=this.start;i<r&&n<64;++i)o[n++]=e[i];else for(n=this.start;i<r&&n<64;++i)c[n>>2]|=e[i]<<SHIFT[3&n++];else if(ARRAY_BUFFER)for(n=this.start;i<r&&n<64;++i)(s=e.charCodeAt(i))<128?o[n++]=s:(s<2048?o[n++]=192|s>>6:(s<55296||57344<=s?o[n++]=224|s>>12:(s=65536+((1023&s)<<10|1023&e.charCodeAt(++i)),o[n++]=240|s>>18,o[n++]=128|s>>12&63),o[n++]=128|s>>6&63),o[n++]=128|63&s);else for(n=this.start;i<r&&n<64;++i)(s=e.charCodeAt(i))<128?c[n>>2]|=s<<SHIFT[3&n++]:(s<2048?c[n>>2]|=(192|s>>6)<<SHIFT[3&n++]:(s<55296||57344<=s?c[n>>2]|=(224|s>>12)<<SHIFT[3&n++]:(s=65536+((1023&s)<<10|1023&e.charCodeAt(++i)),c[n>>2]|=(240|s>>18)<<SHIFT[3&n++],c[n>>2]|=(128|s>>12&63)<<SHIFT[3&n++]),c[n>>2]|=(128|s>>6&63)<<SHIFT[3&n++]),c[n>>2]|=(128|63&s)<<SHIFT[3&n++]);this.lastByteIndex=n,this.bytes+=n-this.start,64<=n?(this.start=n-64,this.hash(),this.hashed=!0):this.start=n}return 4294967295<this.bytes&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Md5.prototype.finalize=function(){var e,t;this.finalized||(this.finalized=!0,(e=this.blocks)[(t=this.lastByteIndex)>>2]|=EXTRA[3&t],56<=t&&(this.hashed||this.hash(),e[0]=e[16],e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.bytes<<3,e[15]=this.hBytes<<3|this.bytes>>>29,this.hash())},Md5.prototype.hash=function(){var e,t,a,s,n,i=this.blocks,r=this.first?((r=((e=((e=i[0]-680876937)<<7|e>>>25)-271733879<<0)^(t=((t=(-271733879^(a=((a=(-1732584194^2004318071&e)+i[1]-117830708)<<12|a>>>20)+e<<0)&(-271733879^e))+i[2]-1126478375)<<17|t>>>15)+a<<0)&(a^e))+i[3]-1316259209)<<22|r>>>10)+t<<0:(e=this.h0,r=this.h1,t=this.h2,((r+=((e=((e+=((a=this.h3)^r&(t^a))+i[0]-680876936)<<7|e>>>25)+r<<0)^(t=((t+=(r^(a=((a+=(t^e&(r^t))+i[1]-389564586)<<12|a>>>20)+e<<0)&(e^r))+i[2]+606105819)<<17|t>>>15)+a<<0)&(a^e))+i[3]-1044525330)<<22|r>>>10)+t<<0);r=((r+=((e=((e+=(a^r&(t^a))+i[4]-176418897)<<7|e>>>25)+r<<0)^(t=((t+=(r^(a=((a+=(t^e&(r^t))+i[5]+1200080426)<<12|a>>>20)+e<<0)&(e^r))+i[6]-1473231341)<<17|t>>>15)+a<<0)&(a^e))+i[7]-45705983)<<22|r>>>10)+t<<0,r=((r+=((e=((e+=(a^r&(t^a))+i[8]+1770035416)<<7|e>>>25)+r<<0)^(t=((t+=(r^(a=((a+=(t^e&(r^t))+i[9]-1958414417)<<12|a>>>20)+e<<0)&(e^r))+i[10]-42063)<<17|t>>>15)+a<<0)&(a^e))+i[11]-1990404162)<<22|r>>>10)+t<<0,r=((r+=((e=((e+=(a^r&(t^a))+i[12]+1804603682)<<7|e>>>25)+r<<0)^(t=((t+=(r^(a=((a+=(t^e&(r^t))+i[13]-40341101)<<12|a>>>20)+e<<0)&(e^r))+i[14]-1502002290)<<17|t>>>15)+a<<0)&(a^e))+i[15]+1236535329)<<22|r>>>10)+t<<0,r=((r+=((a=((a+=(r^t&((e=((e+=(t^a&(r^t))+i[1]-165796510)<<5|e>>>27)+r<<0)^r))+i[6]-1069501632)<<9|a>>>23)+e<<0)^e&((t=((t+=(e^r&(a^e))+i[11]+643717713)<<14|t>>>18)+a<<0)^a))+i[0]-373897302)<<20|r>>>12)+t<<0,r=((r+=((a=((a+=(r^t&((e=((e+=(t^a&(r^t))+i[5]-701558691)<<5|e>>>27)+r<<0)^r))+i[10]+38016083)<<9|a>>>23)+e<<0)^e&((t=((t+=(e^r&(a^e))+i[15]-660478335)<<14|t>>>18)+a<<0)^a))+i[4]-405537848)<<20|r>>>12)+t<<0,r=((r+=((a=((a+=(r^t&((e=((e+=(t^a&(r^t))+i[9]+568446438)<<5|e>>>27)+r<<0)^r))+i[14]-1019803690)<<9|a>>>23)+e<<0)^e&((t=((t+=(e^r&(a^e))+i[3]-187363961)<<14|t>>>18)+a<<0)^a))+i[8]+1163531501)<<20|r>>>12)+t<<0,r=((r+=((a=((a+=(r^t&((e=((e+=(t^a&(r^t))+i[13]-1444681467)<<5|e>>>27)+r<<0)^r))+i[2]-51403784)<<9|a>>>23)+e<<0)^e&((t=((t+=(e^r&(a^e))+i[7]+1735328473)<<14|t>>>18)+a<<0)^a))+i[12]-1926607734)<<20|r>>>12)+t<<0,r=((r+=((n=(a=((a+=((s=r^t)^(e=((e+=(s^a)+i[5]-378558)<<4|e>>>28)+r<<0))+i[8]-2022574463)<<11|a>>>21)+e<<0)^e)^(t=((t+=(n^r)+i[11]+1839030562)<<16|t>>>16)+a<<0))+i[14]-35309556)<<23|r>>>9)+t<<0,r=((r+=((n=(a=((a+=((s=r^t)^(e=((e+=(s^a)+i[1]-1530992060)<<4|e>>>28)+r<<0))+i[4]+1272893353)<<11|a>>>21)+e<<0)^e)^(t=((t+=(n^r)+i[7]-155497632)<<16|t>>>16)+a<<0))+i[10]-1094730640)<<23|r>>>9)+t<<0,r=((r+=((n=(a=((a+=((s=r^t)^(e=((e+=(s^a)+i[13]+681279174)<<4|e>>>28)+r<<0))+i[0]-358537222)<<11|a>>>21)+e<<0)^e)^(t=((t+=(n^r)+i[3]-722521979)<<16|t>>>16)+a<<0))+i[6]+76029189)<<23|r>>>9)+t<<0,r=((r+=((n=(a=((a+=((s=r^t)^(e=((e+=(s^a)+i[9]-640364487)<<4|e>>>28)+r<<0))+i[12]-421815835)<<11|a>>>21)+e<<0)^e)^(t=((t+=(n^r)+i[15]+530742520)<<16|t>>>16)+a<<0))+i[2]-995338651)<<23|r>>>9)+t<<0,r=((r+=((a=((a+=(r^((e=((e+=(t^(r|~a))+i[0]-198630844)<<6|e>>>26)+r<<0)|~t))+i[7]+1126891415)<<10|a>>>22)+e<<0)^((t=((t+=(e^(a|~r))+i[14]-1416354905)<<15|t>>>17)+a<<0)|~e))+i[5]-57434055)<<21|r>>>11)+t<<0,r=((r+=((a=((a+=(r^((e=((e+=(t^(r|~a))+i[12]+1700485571)<<6|e>>>26)+r<<0)|~t))+i[3]-1894986606)<<10|a>>>22)+e<<0)^((t=((t+=(e^(a|~r))+i[10]-1051523)<<15|t>>>17)+a<<0)|~e))+i[1]-2054922799)<<21|r>>>11)+t<<0,r=((r+=((a=((a+=(r^((e=((e+=(t^(r|~a))+i[8]+1873313359)<<6|e>>>26)+r<<0)|~t))+i[15]-30611744)<<10|a>>>22)+e<<0)^((t=((t+=(e^(a|~r))+i[6]-1560198380)<<15|t>>>17)+a<<0)|~e))+i[13]+1309151649)<<21|r>>>11)+t<<0,r=((r+=((a=((a+=(r^((e=((e+=(t^(r|~a))+i[4]-145523070)<<6|e>>>26)+r<<0)|~t))+i[11]-1120210379)<<10|a>>>22)+e<<0)^((t=((t+=(e^(a|~r))+i[2]+718787259)<<15|t>>>17)+a<<0)|~e))+i[9]-343485551)<<21|r>>>11)+t<<0,this.first?(this.h0=e+1732584193<<0,this.h1=r-271733879<<0,this.h2=t-1732584194<<0,this.h3=a+271733878<<0,this.first=!1):(this.h0=this.h0+e<<0,this.h1=this.h1+r<<0,this.h2=this.h2+t<<0,this.h3=this.h3+a<<0)},Md5.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,a=this.h2,s=this.h3;return HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[a>>4&15]+HEX_CHARS[15&a]+HEX_CHARS[a>>12&15]+HEX_CHARS[a>>8&15]+HEX_CHARS[a>>20&15]+HEX_CHARS[a>>16&15]+HEX_CHARS[a>>28&15]+HEX_CHARS[a>>24&15]+HEX_CHARS[s>>4&15]+HEX_CHARS[15&s]+HEX_CHARS[s>>12&15]+HEX_CHARS[s>>8&15]+HEX_CHARS[s>>20&15]+HEX_CHARS[s>>16&15]+HEX_CHARS[s>>28&15]+HEX_CHARS[s>>24&15]},Md5.prototype.toString=Md5.prototype.hex,Md5.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,a=this.h2,s=this.h3;return[255&e,e>>8&255,e>>16&255,e>>24&255,255&t,t>>8&255,t>>16&255,t>>24&255,255&a,a>>8&255,a>>16&255,a>>24&255,255&s,s>>8&255,s>>16&255,s>>24&255]},Md5.prototype.array=Md5.prototype.digest,Md5.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(16),t=new Uint32Array(e);return t[0]=this.h0,t[1]=this.h1,t[2]=this.h2,t[3]=this.h3,e},Md5.prototype.buffer=Md5.prototype.arrayBuffer,Md5.prototype.base64=function(){for(var e,t,a,s="",n=this.array(),i=0;i<15;)e=n[i++],t=n[i++],a=n[i++],s+=BASE64_ENCODE_CHAR[e>>>2]+BASE64_ENCODE_CHAR[63&(e<<4|t>>>4)]+BASE64_ENCODE_CHAR[63&(t<<2|a>>>6)]+BASE64_ENCODE_CHAR[63&a];return e=n[i],s+=BASE64_ENCODE_CHAR[e>>>2]+BASE64_ENCODE_CHAR[e<<4&63]+"=="},createMethod()}(),mock_data={action:{},device:{type:"mobile",deviceId:{},hardwareConfig:{},softwareConfig:{},runtimeConfig:{}},networks:[{type:"wifi",available:!1,connected:!1},{type:"cellular",available:!1,connected:!1,current:[]}],locations:[],appContext:{},app:{appKey:_TD_quick_config.default.appKey,channel:"quickapp"},sdk:{from:1,version:1,minorVersion:0,build:3,platform:"quickapp",framework:"quickapp"},ts:"xxxxx"};function random(){for(var e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890",t=e.length,a="",s=0;s<12;s++)a+=e.charAt(Math.floor(Math.random()*t));return a}function getAppInfo(e){try{var t=_system3.default.getInfo();e.app.globalId=t.packageName,e.app.displayName=t.name,e.app.versionName=t.versionName,e.app.versionCode=t.versionCode,e.app.installTime="";var a=(new Date).getTime();return e.appContext.sessionStartTime=a,e.appContext.sessionId="quickapp-".concat(a,"-").concat(random()),e}catch(e){console.log("获取应用信息错误",e)}}function Observe(e){this._param=e,this.init(e.status)}function observe(e){if(e.status&&"object"===_typeof(e.status))return new Observe(e)}function getAvailableStorage(t,a){try{_system5.default.getAvailableStorage({success:function(e){a.device.runtimeConfig.freeDiskSpace=e.availableStorage,t.freeDiskSpace=1},fail:function(){t.freeDiskSpace=2}})}catch(e){console.log("获取设备存储空间大小",e)}}function getBatteryStatus(t,a){try{_system8.default.getStatus({success:function(e){a.device.runtimeConfig.batteryLevel=e.level,a.device.runtimeConfig.batteryState=e.charging,t.battery=1},fail:function(){t.battery=2}})}catch(e){console.log("获取电池信息",e)}}function getBrightness(t,a){try{_system7.default.getValue({success:function(e){a.device.hardwareConfig.brightness=e.value,t.brightness=1},fail:function(){t.brightness=2}})}catch(e){console.log("获取设备的屏幕亮度",e)}}function getNetwork(e,a){try{_system9.default.getType({success:function(t){"none"==t.type?a.networks.forEach(function(e){"wifi"==e.type&&(e.available=!1,e.connected=!1),"cellular"==e.type&&(e.available=!1,e.connected=!1,e.current=[])}):0==t.metered&&"wifi"==t.type?a.networks.forEach(function(e){"wifi"==e.type&&(e.available=!0,e.connected=!0),"cellular"==e.type&&(e.available=!1,e.connected=!1,e.current=[])}):1==t.metered&&/\g/gi.test(t.type)&&a.networks.forEach(function(e){"wifi"==e.type&&(e.available=!1,e.connected=!1),"cellular"==e.type&&(e.available=!0,e.connected=!0,e.current=[],e.current.push({type:t.type}))}),e.networks=1},fail:function(){e.networks=2}})}catch(e){console.log("获取网络类型",e)}}function getDynamicData(e){var t=e.status,a=e.data;e.trigger?console.log("trigger event"):observe(e);try{getNetwork(t,a),getAvailableStorage(t,a),getBrightness(t,a),getBatteryStatus(t,a)}catch(e){console.log(e)}}function read_quick_Dynamic_status(e){var t=e.status,a=!0;for(var s in t)-1==t[s]&&(a=!1);a&&(_system.default.set({key:"model_base_data",value:JSON.stringify(e.data),success:function(){},fail:function(){}}),_system.default.set({key:"hasSetDynamicData",value:!0,success:function(){},fail:function(){}}))}Observe.prototype={init:function(t){var a=this;Object.keys(t).forEach(function(e){a.convert(t,e,t[e])})},convert:function(e,t,a){this.defineReactive(e,t,a)},defineReactive:function(e,t,a){var s=this;try{Object.defineProperty(e,t,{enumerable:!0,configurable:!1,get:function(){return a},set:function(e){e!==a&&(a=e,s._param.fn&&s._param.fn(s._param))}})}catch(e){console.info("define error",e)}}};var TDgetDeviceId=function(){var a={device:{type:"mobile",deviceId:{androidId:"user",adId:"advertising"}}};return new Promise(function(e,t){_TD_quick_config.default.getDeviceInfo?_system5.default.getId({type:["device","mac","user","advertising"],success:function(e){a.device.deviceId.imeis=e.device,a.device.deviceId.wifiMacs=e.mac,a.device.deviceId.androidId=e.user,a.device.deviceId.adId=e.advertising,t(a)},fail:function(){e()}}):e()}).then(function(){return new Promise(function(t,e){_system5.default.getUserId({success:function(e){a.device.deviceId.androidId=e.userId,t(a)}})})}).then(function(a){return new Promise(function(e,t){_system5.default.getAdvertisingId({success:function(e){a.device.deviceId.adId=e.advertisingId,t(a)}})})}).catch(function(e){return e})};function getCpuInfo(s,n){try{_system5.default.getCpuInfo({success:function(e){var t=e.cpuInfo.replace(/\t/g,"").replace(/\n+/g,";"),a={};t.split(";").forEach(function(e){var t=e.split(":")[0];("processor"==t&&null==a.coreNum||"processor"==t&&Number(e.split(":")[1])>=a.coreNum)&&(a.coreNum=Number(e.split(":")[1])),"Hardware"!=t||null!=a.name&&""!=a.name?a.name="":a.name=e.split(":")[1]}),n.device.hardwareConfig.cpu=a,s.cpu=1},fail:function(){s.cpu=2}})}catch(e){console.log("获取CPU信息",e)}}function getTotalStorage(t,a){try{_system5.default.getTotalStorage({success:function(e){a.device.hardwareConfig.totalDiskSpace=e.totalStorage,t.totalDiskSpace=1},fail:function(){t.totalDiskSpace=2}})}catch(e){console.log("获取设备的总存储",e)}}function getBrandInfo(t,a){try{_system5.default.getInfo({success:function(e){a.device.hardwareConfig.manufacture=e.manufacturer,a.device.hardwareConfig.brand=e.brand,a.device.hardwareConfig.model=e.model,a.device.hardwareConfig.pixel="".concat(e.screenWidth,"*").concat(e.screenHeight,"*").concat(e.pixel||1),a.device.softwareConfig.os=e.osType,a.device.softwareConfig.osVersionName=e.osVersionName,a.device.softwareConfig.osVersionCode=String(e.osVersionCode),a.device.softwareConfig.language=e.language,a.device.softwareConfig.locale=e.region,a.device.softwareConfig.platformVersionName=e.platformVersionName,a.device.softwareConfig.platformVersionCode=e.platformVersionCode,t.brandInfo=1},fail:function(){t.brandInfo=2}})}catch(e){console.log("获取设备信息",e)}}function getLocation(t,a){_TD_quick_config.default.getLocation?_system6.default.getLocation({success:function(e){a.locations||(a.locations=[]),a.locations=[{lat:e.latitude,lng:e.longitude}],t.locations=1},fail:function(){delete a.locations,t.locations=2}}):(delete a.locations,t.locations=2)}function generateTid(e){var t=null,a=null,s=null;e.device&&e.device.deviceId.imeis&&(t=e.device.deviceId.imeis),e.device&&e.device.deviceId.wifiMacs&&(a=e.device.deviceId.wifiMacs),e.device&&e.device.deviceId.androidId&&(s=e.device.deviceId.androidId);var n="3"+md5("".concat(t,"-").concat(a,"-").concat(s));return _system.default.set({key:"TDSDK_tid",value:n}),n}function getTid(t,a,s){_system.default.get({key:"TDSDK_tid",default:"",success:function(e){s.device.deviceId.tid=e||generateTid(a),t.device=1},fail:function(){s.device.deviceId.tid=generateTid(a),t.device=1}})}function getBasicData(e){var t=e.status,a=e.data;observe(e),TDgetDeviceId().then(function(e){e.device&&e.device.deviceId&&(a.device.deviceId=e.device.deviceId),a.device.deviceId.tid=getTid(t,e,a)});try{getBrandInfo(t,a),getTotalStorage(t,a),getCpuInfo(t,a),getLocation(t,a)}catch(e){console.log("获取基本信息错误",e)}}function read_Basic_status(e){var t,a=e.data,s=e.status,n=!0;for(var i in s)-1==s[i]&&(n=!1);try{n&&(a=getAppInfo(a),t=setInterval(function(){_system.default.get({key:"TDSDK_installTime",success:function(e){""!=e&&(clearInterval(t),a.app.installTime=Number(e),a.ts=(new Date).getTime(),_system.default.set({key:"model_base_data",value:JSON.stringify(a),success:function(){}}))}})},1e3))}catch(e){console.log("获取应用基本信息",e)}}function deleteSendedData(a,s){_system.default.get({key:a,success:function(e){var t;e&&(e=JSON.parse(e),Array.isArray(s)||(s=[s]),t=e.filter(function(e){for(var t=0;t<s.length;t++){var a=s[t];if(a.action.domain==e.action.domain&&a.action.data.startTime==e.action.data.startTime)return!1}return!0}),_system.default.set({key:a,value:JSON.stringify(t)}))}})}function fetchSessionStart(t){_system4.default.fetch({url:"https://ap.cpatrk.net/q/a/v1",data:JSON.stringify([t]),method:"POST",success:function(e){200!=e.code&&_system.default.get({key:"sendFailList",success:function(e){(e=""==e?[]:JSON.parse(e)).push(t),_system.default.set({key:"sendFailList",value:JSON.stringify(e),success:function(){}})}})},fail:function(){_system.default.get({key:"sendFailList",success:function(e){(e=""==e?[]:JSON.parse(e)).push(t),_system.default.set({key:"sendFailList",value:JSON.stringify(e),success:function(){}})}})}})}function fetchSessionEnd(t){t.action.data.start=(new Date).getTime(),_system4.default.fetch({url:"https://ap.cpatrk.net/q/a/v1",data:JSON.stringify([t]),method:"POST",success:function(e){200!=e.code&&_system.default.get({key:"sendFailList",success:function(e){(e=""==e?[]:JSON.parse(e)).push(t),_system.default.set({key:"sendFailList",value:JSON.stringify(e),success:function(){}})}})},fail:function(){_system.default.get({key:"sendFailList",success:function(e){(e=""==e?[]:JSON.parse(e)).push(t),_system.default.set({key:"sendFailList",value:JSON.stringify(e)})}})}})}function fetchPageEvent(t){t&&0!=(t=Array.isArray(t)?t:[t]).length&&_system4.default.fetch({url:"https://ap.cpatrk.net/q/a/v1",data:JSON.stringify(t),method:"POST",success:function(e){200!=e.code?_system.default.get({key:"sendFailList",success:function(e){(e=""==e?[]:JSON.parse(e)).push(t),_system.default.set({key:"sendFailList",value:JSON.stringify(e),success:function(){}})}}):deleteSendedData("ReadySendList",t)},fail:function(){_system.default.get({key:"sendFailList",success:function(e){(e=""==e?[]:JSON.parse(e)).push(t),_system.default.set({key:"sendFailList",value:JSON.stringify(e),success:function(){}})}})}})}function fetchInstall(t){_system4.default.fetch({url:"https://ap.cpatrk.net/q/a/v1",data:JSON.stringify([t]),method:"POST",success:function(e){200==e.code&&(t.action.data.first=!1),_system.default.set({key:"TDSDK_initTime",value:JSON.stringify(t),success:function(){}})},fail:function(){_system.default.set({key:"TDSDK_initTime",value:JSON.stringify(t),success:function(){}})}})}function heartBeat(){_system.default.get({key:"sendFailList",success:function(e){if(""!=e&&"[]"!=e){var t=[];if(100<=JSON.parse(e).length)t=JSON.parse(e).slice(0,100);else{t=t.concat(JSON.parse(e));for(var a=0;a<t.length;a++)for(var s=a+1;s<t.length;s++)t[a].ts==t[s].ts&&t.splice(s,1);for(var n=0;n<t.length;n++)for(var i=n+1;i<t.length;i++)t[n].ts==t[i].ts&&t.splice(i,1)}0!=t.length&&_system4.default.fetch({url:"https://ap.cpatrk.net/q/a/v1",data:JSON.stringify(t),method:"POST",success:function(e){200==e.code&&_system.default.set({key:"sendFailList",value:[],success:function(){}})},fail:function(){_system.default.get({key:"sendFailList",success:function(e){e=(e=""==e?[]:JSON.parse(e)).concat(t),_system.default.set({key:"sendFailList",value:JSON.stringify(e),success:function(){}})}})}})}}})}var timer_AfterBasicForDynamic="",timer_new_session_log_data=null,timer_not_new_session_log_data=null;function quickInit(){try{_system.default.set({key:"inittrigger",value:"1"}),_system.default.set({key:"page_enter_time",value:+new Date,success:function(){}});var t={networks:-1,battery:-1,freeDiskSpace:-1,brightness:-1};getBasicData({status:{device:-1,brandInfo:-1,totalDiskSpace:-1,cpu:-1,locations:-1},data:mock_data,fn:read_Basic_status}),timer_AfterBasicForDynamic&&clearInterval(timer_AfterBasicForDynamic),timer_AfterBasicForDynamic=setInterval(function(){_system.default.get({key:"model_base_data",success:function(e){""!=e&&(clearInterval(timer_AfterBasicForDynamic),getDynamicData({status:t,data:JSON.parse(e),fn:read_quick_Dynamic_status,trigger:null}))}})},2e3),setInterval(function(){heartBeat()},3e4)}catch(e){console.log("初始化内容错误~~",e)}}function setSessionLogTimeAndData(){try{var e=(new Date).getTime();_system.default.set({key:"session_start_time",value:e,success:function(){}}),clearInterval(timer_new_session_log_data),timer_new_session_log_data&&clearInterval(timer_new_session_log_data),timer_new_session_log_data=setInterval(function(){_system.default.get({key:"model_base_data",success:function(a){""!=a&&(clearInterval(timer_not_new_session_log_data),_system.default.get({key:"session_start_time",success:function(e){(a=JSON.parse(a)).action={domain:"session",name:"end",data:{start:(new Date).getTime(),duration:parseInt(((new Date).getTime()-e)/1e3)}};var t={time:(new Date).getTime(),data:a,startTime:e};_system.default.set({key:"session_log_Data",value:JSON.stringify(t),success:function(){}})}}))}})},5e3),_system.default.get({key:"TDSDK_initTime",success:function(e){var t,a,s;""==e?(_system.default.set({key:"TDSDK_installTime",value:(new Date).getTime()}),t=setInterval(function(){_system.default.get({key:"hasSetDynamicData",success:function(e){e&&_system.default.get({key:"model_base_data",success:function(e){""!=e&&(clearInterval(t),(e=JSON.parse(e)).action={domain:"app",name:"init",data:{first:!0}},e.ts=(new Date).getTime(),fetchInstall(e))}})}})},100)):e&&1==JSON.parse(e).action.data.first?((a=JSON.parse(e)).action={domain:"app",name:"init",data:{first:!0}},a.ts=(new Date).getTime(),fetchInstall(a)):s=setInterval(function(){_system.default.get({key:"hasSetDynamicData",success:function(e){e&&_system.default.get({key:"model_base_data",success:function(e){""!=e&&(clearInterval(s),(e=JSON.parse(e)).action={domain:"app",name:"init",data:{first:!1}},e.ts=(new Date).getTime(),fetchInstall(e))}})}})},100)}});var a=setInterval(function(){_system.default.get({key:"hasSetDynamicData",success:function(e){e&&_system.default.get({key:"model_base_data",success:function(t){""!=t&&(clearInterval(a),(t=JSON.parse(t)).action={domain:"session",name:"begin",data:{interval:0}},t.ts=(new Date).getTime(),_system.default.get({key:"intervalTime",success:function(e){""!=e&&4e3<new Date-e&&(t.action.data.interval=Math.ceil((new Date-e)/1e3)),fetchSessionStart(t)}}))}})}})},100)}catch(e){console.log("session存储错误")}}function pageLeave(t){try{_system.default.get({key:"inittrigger",success:function(e){"1"===e?(_system.default.set({key:"leaveEventTrigger",value:2}),_system.default.set({key:"page_leave_name",value:t,success:function(){_system.default.get({key:"model_base_data",success:function(a){""!=a&&((a=JSON.parse(a)).action={domain:"page",name:"leave",data:{name:t,duration:"",startTime:"",from:""}},a.ts=(new Date).getTime(),_system.default.get({key:"page_enter_name",success:function(t){_system.default.get({key:"page_leave_name",success:function(e){t==e?_system.default.get({key:"page_enter_time",success:function(e){a.action.data.startTime=Number(e),a.action.data.duration=Math.ceil((new Date-e)/1e3),_system.default.set({key:"page_enter_time",value:+new Date})}}):_system.default.get({key:"page_enter_time",success:function(e){a.action.data.startTime=Number(e)}}),_system.default.get({key:"ReadySendList",success:function(e){e=""==e?[]:JSON.parse(e),""!=a&&e.push(a),_system.default.set({key:"ReadySendList",value:JSON.stringify(e),success:function(){fetchPageEvent(a)}})}})}})}}))}})}}),_system.default.set({key:"intervalTime",value:+new Date})):console.log("没有调用init事件")}})}catch(e){console.log(e)}}function selfEvent(e,t){var a;e&&(t&&t.$app&&t.$app.$def?(a=t.$app.$def,e.ts=(new Date).getTime(),a.tdEvent||(a.tdEvent=[]),a.tdEvent.push(e),selfEventPacking(t)):selfEvent2(e))}function selfEventPacking(a){var s,n=a.$app.$def;n&&n.tdEvent&&0!==n.tdEvent.length&&(s=setInterval(function(){var e=_system2.default.getState(),t=(e.index,e.name,e.path);a.$visible||a.$page.path===t?storageGetWithCallback("inittrigger","",function(e){"1"===e&&storageGetWithCallback("hasSetDynamicData",!1,function(e){e&&storageGetWithCallback("model_base_data","",function(e){e&&(e=JSON.parse(e),clearInterval(s),selfEventItemPacking(e,n.tdEvent),n.tdEvent=[])})})}):clearInterval(s)},1e3))}function selfEventItemPacking(i,e){var r=[];e.forEach(function(e){var t=JSON.parse(JSON.stringify(i));for(var a in t.action={domain:"appEvent",name:e.eventId||"",data:{eventLabel:e.eventLabel||"",eventParam:{}}},t.action.data.eventParam=Object.assign(t.action.data.eventParam,e.params),t.action.data.eventParam)""===t.action.data.eventParam[a]&&delete t.action.data.eventParam[a];var s=0;for(var n in t.action.data.eventParam)50<++s&&delete t.action.data.eventParam[n];t.ts=e.ts,r.push(t)}),storageGetWithCallback("ReadySendList",null,function(e){0!=(e=(e=""==e?[]:JSON.parse(e)).concat(r)).length&&_system.default.set({key:"ReadySendList",value:JSON.stringify(e),success:function(){fetchPageEvent(r)}})})}function storageGetWithCallback(e,t,a,s){_system.default.get({key:e,default:t,success:a,fail:s})}function selfEvent2(i){try{_system.default.get({key:"inittrigger",success:function(e){var n;"1"===e?n=setInterval(function(){_system.default.get({key:"hasSetDynamicData",success:function(e){e&&_system.default.get({key:"model_base_data",success:function(t){if(""!=t){for(var e in clearInterval(n),(t=JSON.parse(t)).action={domain:"appEvent",name:i.eventId||"",data:{eventLabel:i.label||"",eventParam:{}}},t.action.data.eventParam=Object.assign(t.action.data.eventParam,i.params),t.action.data.eventParam)""===t.action.data.eventParam[e]&&delete t.action.data.eventParam[e];var a=0;for(var s in t.action.data.eventParam)50<++a&&delete t.action.data.eventParam[s];t.ts=(new Date).getTime(),_system.default.get({key:"ReadySendList",success:function(e){e=""==e?[]:JSON.parse(e),""!=t&&e.push(t),_system.default.set({key:"ReadySendList",value:JSON.stringify(e),success:function(){fetchPageEvent(t)}})}})}}})}})},1e3):console.log("没有调用init事件")}})}catch(e){console.log(e)}}function getEventList(i,e){var r=[];if(e&&e.$app&&e.$app.$def&&e.$app.$def.tdEvent){var t=e.$app.$def.tdEvent;if(0==t.length)return r;t.forEach(function(e){var t=JSON.parse(JSON.stringify(i));for(var a in t.action={domain:"appEvent",name:e.eventId||"",data:{eventLabel:e.eventLabel||"",eventParam:{}}},t.action.data.eventParam=Object.assign(t.action.data.eventParam,e.params),t.action.data.eventParam)""===t.action.data.eventParam[a]&&delete t.action.data.eventParam[a];var s=0;for(var n in t.action.data.eventParam)50<++s&&delete t.action.data.eventParam[n];t.ts=e.ts,r.push(t)}),e.$app.$def.tdEvent=[]}return r}function pageEnter(n,i){try{_system.default.get({key:"inittrigger",success:function(e){var s,t,a;"1"===e?(_system.default.set({key:"page_enter_name",value:n}),_system.default.get({key:"leaveEventTrigger",success:function(e){2==e?_system.default.set({key:"leaveEventTrigger",value:1}):_system.default.set({key:"page_enter_time",value:+new Date})}}),_system.default.get({key:"intervalTime",success:function(e){""!=e&&4e3<new Date-e&&_system.default.set({key:"page_enter_time",value:+new Date})}}),s=setInterval(function(){_system.default.get({key:"model_base_data",success:function(t){var a;""!=t&&(clearInterval(s),(t=JSON.parse(t)).action={domain:"page",name:"enter",data:{name:n,startTime:+new Date,from:""}},t.ts=(new Date).getTime(),_system.default.get({key:"from",success:function(e){t.action.data.from=e,_system.default.set({key:"from",value:_system2.default.getState().name,success:function(){}})},fail:function(){t.action.data.from=""}}),a=getEventList(t,i),t&&a.push(t),_system.default.get({key:"ReadySendList",success:function(e){e=""==e?[]:JSON.parse(e),0<a.length&&(e=e.concat(a),_system.default.set({key:"ReadySendList",value:JSON.stringify(e),success:function(){fetchPageEvent(a)}}))}}))}})},600),t=(new Date).getTime(),a={networks:-1,battery:-1,freeDiskSpace:-1,brightness:-1},timer_AfterBasicForDynamic&&clearInterval(timer_AfterBasicForDynamic),timer_AfterBasicForDynamic=setInterval(function(){_system.default.get({key:"model_base_data",success:function(e){""!=e&&""!=(e=JSON.parse(e)).device.runtimeConfig.freeDiskSpace&&(clearInterval(timer_AfterBasicForDynamic),getDynamicData({status:a,data:e,fn:read_quick_Dynamic_status,trigger:null}))}})},1e3),_system.default.get({key:"session_log_Data",success:function(e){""==e?setSessionLogTimeAndData():e&&3e4<=t-JSON.parse(e).time?(fetchSessionEnd(JSON.parse(e).data),setSessionLogTimeAndData()):(clearInterval(timer_not_new_session_log_data),timer_not_new_session_log_data=setInterval(function(){_system.default.get({key:"hasSetDynamicData",success:function(e){e&&(clearInterval(timer_new_session_log_data),_system.default.get({key:"model_base_data",success:function(a){_system.default.get({key:"session_start_time",success:function(e){(a=JSON.parse(a)).action={domain:"session",name:"end",data:{start:(new Date).getTime(),duration:parseInt(((new Date).getTime()-e)/1e3)}};var t={time:(new Date).getTime(),data:a,startTime:e};_system.default.set({key:"session_log_Data",value:JSON.stringify(t),success:function(){}})}})}}))}})},5e3))}})):console.log("没有调用init事件")}})}catch(e){console.log(e)}}function eventItemPackaging(e){if(!e||0==e.length)return[];var i=[];return e.forEach(function(e){var t=JSON.parse(JSON.stringify(data));for(var a in t.action={domain:"appEvent",name:e.eventId||"",data:{eventLabel:e.eventLabel||"",eventParam:{}}},t.action.data.eventParam=Object.assign(t.action.data.eventParam,e.params),t.action.data.eventParam)""===t.action.data.eventParam[a]&&delete t.action.data.eventParam[a];var s=0;for(var n in t.action.data.eventParam)50<++s&&delete t.action.data.eventParam[n];t.ts=e.ts,i.push(t)}),i}function setTDChannelId(t){var a;t&&(mock_data.app.channel=t,a=setInterval(function(){_system.default.get({key:"model_base_data",success:function(e){e&&(clearInterval(a),(e=JSON.parse(e)).app.channel=t,_system.default.set({key:"model_base_data",value:JSON.stringify(e)}))}})},500))}function setTDAccount(t){var a;t.accountId||/0{1}/.test(t.accountId)?t.accountType||/0{1}/.test(t.accountType)?(mock_data.appContext.account=t,a=setInterval(function(){_system.default.get({key:"model_base_data",success:function(e){e&&(clearInterval(a),(e=JSON.parse(e)).appContext.account=t,_system.default.set({key:"model_base_data",value:JSON.stringify(e)}))}})},500)):console.warn("accountType为必填字段！"):console.warn("accountId为必填字段！")}